# Deployment Checklist

Use this checklist to ensure a smooth deployment of the RAG Finance System.

---

## Pre-Deployment

### Code & Repository
- [ ] All tests passing locally (`pytest`)
- [ ] Code linted and formatted (`flake8 src/ scripts/`)
- [ ] All changes committed to git
- [ ] Pushed to GitHub repository
- [ ] README.md is up to date

### API Keys & Credentials
- [ ] OpenAI API key obtained
- [ ] (Optional) Pinecone API key for production
- [ ] API keys have sufficient quota/credits
- [ ] Test API keys locally before deployment

### Environment Configuration
- [ ] `.env.example` reviewed
- [ ] Required environment variables identified
- [ ] Optional environment variables considered
- [ ] Security settings configured

---

## Platform Setup

### Railway (if using)
- [ ] Railway account created
- [ ] Railway CLI installed (`npm i -g @railway/cli`)
- [ ] Authenticated with Railway (`railway login`)
- [ ] Project created or linked
- [ ] `railway.json` configuration reviewed

### Render (if using)
- [ ] Render account created
- [ ] GitHub repository connected
- [ ] `render.yaml` configuration reviewed
- [ ] Persistent disk configured (1GB minimum)

### GitHub Actions (for CI/CD)
- [ ] Repository has `.github/workflows/deploy.yml`
- [ ] GitHub secrets configured (see below)
- [ ] Workflow permissions set correctly
- [ ] Branch protection rules configured (optional)

---

## GitHub Secrets Configuration

### Required for Tests
- [ ] `OPENAI_API_KEY` - OpenAI API key for running tests

### Required for Railway Deployment
- [ ] `RAILWAY_TOKEN` - Railway API token
- [ ] `RAILWAY_PROJECT_ID` - Your Railway project ID
- [ ] `RAILWAY_URL` - Your Railway app URL

### Required for Render Deployment
- [ ] `RENDER_API_KEY` - Render API key
- [ ] `RENDER_SERVICE_ID` - Your Render service ID
- [ ] `RENDER_URL` - Your Render app URL

### Optional
- [ ] `DOCKER_USERNAME` - Docker Hub username
- [ ] `DOCKER_PASSWORD` - Docker Hub password/token
- [ ] `SLACK_WEBHOOK` - For deployment notifications

---

## Deployment

### Initial Deployment

#### Railway
- [ ] Environment variables set via CLI or dashboard
  ```bash
  railway variables set OPENAI_API_KEY="sk-..."
  railway variables set VECTOR_STORE_MODE="chroma"
  railway variables set MAX_CORRECTIONS="2"
  ```
- [ ] Deploy: `railway up`
- [ ] Deployment successful (check logs)
- [ ] Service URL obtained

#### Render
- [ ] Environment variables set in dashboard
- [ ] Persistent disk configured
- [ ] Build started automatically
- [ ] Deployment successful (check logs)
- [ ] Service URL obtained

### Post-Deployment Verification
- [ ] Health endpoint responds: `curl https://your-app/health`
- [ ] API docs accessible: `https://your-app/docs`
- [ ] Test query successful:
  ```bash
  curl -X POST https://your-app/query \
    -H "Content-Type: application/json" \
    -d '{"query": "What is this system?"}'
  ```
- [ ] Response time acceptable (< 10 seconds)
- [ ] No errors in logs
- [ ] Memory/CPU usage normal

---

## Monitoring Setup

### Platform Monitoring
- [ ] Logs accessible and readable
- [ ] Built-in metrics dashboard reviewed
- [ ] Alert thresholds configured
- [ ] Notification channels set up

### Application Monitoring (Optional)
- [ ] Grafana Cloud account (if using)
- [ ] OpenTelemetry endpoint configured
- [ ] Tracing enabled and working
- [ ] Custom dashboards imported

### Cost Monitoring
- [ ] OpenAI usage dashboard checked
- [ ] Platform billing dashboard reviewed
- [ ] Budget alerts configured
- [ ] Cost tracking implemented in app

---

## Security

### API Security
- [ ] HTTPS enabled (automatic on Railway/Render)
- [ ] API keys stored as secrets (not in code)
- [ ] Environment variables not exposed in logs
- [ ] Input validation working (Pydantic models)

### Access Control (Optional)
- [ ] API authentication implemented
- [ ] Rate limiting configured
- [ ] CORS settings reviewed
- [ ] Custom domain with SSL

### Regular Maintenance
- [ ] Dependency updates scheduled
- [ ] Security patch process defined
- [ ] API key rotation policy
- [ ] Backup strategy (for Chroma data)

---

## Performance Optimization

### Initial Configuration
- [ ] Vector store mode chosen (chroma vs pinecone)
- [ ] Retrieval parameters tuned (`RETRIEVAL_TOP_K`)
- [ ] LLM temperature set appropriately
- [ ] Max corrections configured

### Scaling Considerations
- [ ] Hosting plan adequate for expected load
- [ ] Auto-scaling enabled (Render Standard+)
- [ ] Database/storage sufficient
- [ ] CDN considered for assets (if any)

### Cost Optimization
- [ ] Cost limits configured (`MAX_COST_PER_QUERY`)
- [ ] Token usage optimized
- [ ] Caching strategy considered
- [ ] Model selection appropriate (gpt-4 vs gpt-4o-mini)

---

## Documentation

### User-Facing
- [ ] README.md complete with deployment info
- [ ] API documentation accessible
- [ ] Environment variables documented
- [ ] Example queries provided

### Developer-Facing
- [ ] DEPLOYMENT.md reviewed
- [ ] QUICK_DEPLOY.md available
- [ ] Architecture diagrams up to date
- [ ] Troubleshooting guide complete

---

## CI/CD Pipeline

### GitHub Actions Workflow
- [ ] Test job runs on all PRs
- [ ] Build job creates Docker image
- [ ] Deploy job triggers on main branch only
- [ ] Health checks verify deployment
- [ ] Notification job alerts on failure

### Testing
- [ ] Unit tests pass
- [ ] Integration tests pass
- [ ] Coverage threshold met (80%+)
- [ ] Linting checks pass

### Deployment Flow
- [ ] Manual approval required (optional)
- [ ] Rollback strategy defined
- [ ] Blue-green deployment (optional)
- [ ] Canary deployment (optional)

---

## Post-Launch

### Week 1
- [ ] Monitor error rates daily
- [ ] Check response times
- [ ] Review cost/usage
- [ ] Collect user feedback
- [ ] Fix critical issues

### Week 2-4
- [ ] Optimize based on metrics
- [ ] Scale resources if needed
- [ ] Implement caching if beneficial
- [ ] Tune LLM parameters
- [ ] Update documentation

### Ongoing
- [ ] Weekly cost review
- [ ] Monthly dependency updates
- [ ] Quarterly security audit
- [ ] Continuous performance monitoring
- [ ] Regular backups (if using ChromaDB)

---

## Troubleshooting Quick Reference

### Build Failures
```bash
# Test Docker build locally
docker build -t rag-finance-system .
docker run -p 8000:8000 -e OPENAI_API_KEY=$KEY rag-finance-system
```

### Deployment Failures
- Check logs in platform dashboard
- Verify all environment variables set
- Ensure API key is valid and has quota
- Review Docker container health

### Runtime Errors
- Check `/health` endpoint
- Review application logs
- Verify OpenAI API status
- Check disk space (ChromaDB)

### Performance Issues
- Monitor response times
- Check token usage
- Review retrieval settings
- Consider upgrading plan

---

## Success Criteria

✅ Deployment complete when:
1. Health check returns 200 OK
2. API docs accessible
3. Test query returns valid response
4. No critical errors in logs
5. Response time < 10 seconds
6. Monitoring dashboards show data
7. Cost tracking working
8. Documentation updated

---

## Rollback Plan

If deployment fails:

1. **Railway:**
   ```bash
   railway rollback
   ```

2. **Render:**
   - Dashboard → Service → "Rollback" button
   - Or redeploy previous commit

3. **GitHub Actions:**
   - Revert commit: `git revert HEAD`
   - Push: `git push origin main`
   - Auto-deploys previous version

---

## Support Contacts

- **Railway Support**: [Discord](https://discord.gg/railway)
- **Render Support**: [Community Forum](https://community.render.com/)
- **OpenAI Support**: [Platform Help](https://help.openai.com/)
- **Project Issues**: [GitHub Issues](your-repo/issues)

---

## Notes

Use this space for deployment-specific notes:

```
Date: ___________
Platform: Railway / Render (circle one)
Deployed By: ___________
URL: ___________
Special Configurations:
- 
- 
Issues Encountered:
- 
- 
```

---

**Last Updated**: 2025-12-09

